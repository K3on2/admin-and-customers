<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Booking Information - Al Ayadi Al Sarea Cleaning Services</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@400;600;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://unpkg.com/boxicons@latest/css/boxicons.min.css">
  <link rel="stylesheet" href="cleaningAgent.css">
</head>
<body>

<!-- Header -->
<header>
  <div class="logo-container">
    <img src="logo.png" alt="logo" class="logo-img">
    <div class="logo-text-group">
      <span class="logo-text">
        Al Ayadi <span class="highlight">Al</span> <span class="high">Sarea</span>
      </span>
      <span class="logo-subtext">Cleaning Services</span>
    </div>
  </div>

  <div class="nav-right">
    <ul class="navlist">
      <li><a href="#" onclick="home()">Home</a></li>
      <li><a href="#">About Us</a></li>
      <li><a href="#">FAQ</a></li>
      <li><a href="#">Contact Us</a></li>
    </ul>
    <div class="search-bar">
      <input type="text" placeholder="Search...">
      <i class="bx bx-search"></i>
    </div>
  </div>
</header>

<!-- Booking Section -->
<section class="booking-section">
  <div class="booking-card">
    <!-- Sidebar -->
    <ul class="booking-details">
      <li><i class="bx bx-user"></i> Customer Details</li>
      <li><i class="bx bx-calendar"></i> Date & Time</li>
      <li><i class="bx bx-brush"></i> Type of Cleaning</li>
      <li><i class="bx bx-group"></i> Preferred Cleaning Agents</li>
      <li><i class="bx bx-edit-alt"></i> Special Requests</li>
      <li><i class="bx bx-receipt"></i> Billing Summary</li>
      <li><i class="bx bx-check-circle"></i> Booking Confirmation</li>
    </ul>

    <!-- Right Form -->
    <div class="booking-form">
      <h2>Booking Information</h2>
      <p>Select preferred cleaning agents:</p>

      <div class="cleaning-options">
        <button class="option tooltip"><span class="label">All-Purpose Cleaners</span><span class="tooltip-text">For general surface cleaning.</span></button>
        <button class="option tooltip"><span class="label">Disinfectants</span><span class="tooltip-text">To kill germs and bacteria, especially in kitchens and bathrooms.</span></button>
        <button class="option tooltip"><span class="label">Glass Cleaners</span><span class="tooltip-text">For streak-free windows and mirrors.</span></button>
        <button class="option tooltip"><span class="label">Degreasers</span><span class="tooltip-text">To remove grease and oil from kitchen surfaces.</span></button>
        <button class="option tooltip"><span class="label">Floor Cleaners</span><span class="tooltip-text">For tile, wood, or vinyl floors.</span></button>
        <button class="option tooltip"><span class="label">Bathroom Cleaners</span><span class="tooltip-text">Specialized for removing soap scum, limescale, and stains.</span></button>
        <button class="option tooltip"><span class="label">Carpet & Upholstery Cleaners</span><span class="tooltip-text">For spot cleaning and stain removal.</span></button>
        <button class="option tooltip"><span class="label">Eco-Friendly Solutions</span><span class="tooltip-text">Non-toxic, biodegradable products safe for kids and pets.</span></button>
        <button class="option tooltip"><span class="label">Abrasive Cleaners</span><span class="tooltip-text">For scrubbing stubborn dirt on tough surfaces like tiles and grout.</span></button>
        <button class="option tooltip"><span class="label">Acidic Cleaners</span><span class="tooltip-text">To remove mineral deposits, rust, or limescale (used carefully).</span></button>
        <button class="option tooltip"><span class="label">Enzyme-Based Cleaners</span><span class="tooltip-text">For breaking down organic stains and odors, especially in kitchens and pet areas.</span></button>
        <button class="option tooltip"><span class="label">Polishes</span><span class="tooltip-text">For shining and protecting wood, metal, or stone surfaces.</span></button>
        <button class="option tooltip"><span class="label">Odor Neutralizers / Air Fresheners</span><span class="tooltip-text">To leave spaces smelling fresh.</span></button>
        <button class="option tooltip"><span class="label">Mold & Mildew Removers</span><span class="tooltip-text">For sanitizing damp areas like bathrooms.</span></button>		
        <button class="option tooltip"><span class="label">Wood Conditioners</span><span class="tooltip-text">To maintain and protect wood furniture and floors.</span></button>	
        <button class="option tooltip"><span class="label">Floor Waxes</span><span class="tooltip-text">For shine and protection on vinyl or hardwood floors.</span></button>
      </div>

      <div class="btn-row">
        <button class="btn btn-back" onclick="assist1()">Back</button>
        <button class="btn btn-next">Next</button>
      </div>
    </div>
  </div>
</section>

<!-- Footer -->
<footer class="footer">
  <p>&copy; 2025 Al Ayadi Al Sarea Cleaning Services. All Rights Reserved.</p>
</footer>

<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

<script>
// Firebase config
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "test-81103.firebaseapp.com",
  databaseURL: "https://test-81103-default-rtdb.firebaseio.com",
  projectId: "test-81103",
  storageBucket: "test-81103.appspot.com",
  messagingSenderId: "YOUR_SENDER_ID",
  appId: "YOUR_APP_ID"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const materialsRef = db.ref('materials');
const userSelectionsRef = db.ref('userSelections/USER_ID'); // replace with real user ID

const options = document.querySelectorAll(".option");

// Load previous selections
window.addEventListener("DOMContentLoaded", async () => {
  const snapshot = await userSelectionsRef.once('value');
  const savedSelections = snapshot.val() || [];
  options.forEach(btn => {
    const name = btn.querySelector(".label").innerText.trim();
    if (savedSelections.includes(name)) btn.classList.add("selected");
  });
});

// Toggle UI selection only (no stock update yet)
options.forEach(btn => {
  btn.addEventListener("click", () => {
    btn.classList.toggle("selected");
  });
});

// Handle stock + save on Next
document.querySelector(".btn-next").addEventListener("click", () => {
  const selectedAgents = Array.from(document.querySelectorAll(".option.selected"))
    .map(el => el.querySelector(".label").innerText.trim());

  // Load old selections
  userSelectionsRef.once("value", snapshot => {
    const oldSelections = snapshot.val() || [];

    // Find deselected items → add stock back
    const removed = oldSelections.filter(item => !selectedAgents.includes(item));
    removed.forEach(name => {
      materialsRef.orderByChild("name").equalTo(name).once("value", snap => {
        snap.forEach(child => {
          materialsRef.child(child.key).transaction(d => {
            if (d) d.stockQty += 1;
            return d;
          });
        });
      });
    });

    // Find newly selected items → deduct stock
    const added = selectedAgents.filter(item => !oldSelections.includes(item));
    added.forEach(name => {
      materialsRef.orderByChild("name").equalTo(name).once("value", snap => {
        snap.forEach(child => {
          materialsRef.child(child.key).transaction(d => {
            if (d) {
              if (d.stockQty > 0) {
                d.stockQty -= 1;
              } else {
                alert(`${name} is out of stock!`);
                document.querySelectorAll(".option").forEach(btn => {
                  if (btn.querySelector(".label").innerText.trim() === name) {
                    btn.classList.remove("selected");
                  }
                });
              }
            }
            return d;
          });
        });
      });
    });

    // Save new selections
    userSelectionsRef.set(selectedAgents);

    // Move to next step
    reques();
  });
});

// Update stock tooltips + disable buttons when stock = 0
materialsRef.on('value', snapshot => {
  const data = snapshot.val();
  options.forEach(btn => {
    const name = btn.querySelector(".label").innerText.trim();
    for (const key in data) {
      if (data[key].name === name) {
        const qty = data[key].stockQty;
        btn.title = "Stock left: " + qty;
        btn.disabled = qty <= 0 && !btn.classList.contains("selected");
      }
    }
  });
});
</script>

<script src="home.js"></script>
<script src="assist1.js"></script>
<script src="reques.js"></script>

</body>
</html>
